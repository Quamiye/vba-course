<html lang="fr">
<head>
	<title>Fonctions</title>
	<link rel="stylesheet" href="../Template1CSS.css">
	<meta name="viewport" content="width=device-width, height=device-height, initial-scale=1.0">
	<meta charset="utf-8"/>
	</head>

<body>

<div id="lateral">
	<!--Titre-->
	<div id="title">Programmation VBA pour Excel</div>
	
	<!--Tableau menu-->
	<table id="tabmenu">
		<tr><td><a href="../PagesDivers/Accueil.html" target="_top">Accueil</a></td></tr>
		<tr><td><a href="../PagesCours/SommaireCours.html" target="_top">Sommaire du cours</a></td></tr>
		<tr><td><a href="../Exercices/SommaireExo.html" target="_top">Sommaire des exercices</a></td></tr>
		<tr><td><a href="../PagesDivers/Resume.html" target="_blank">Résumé du cours</a></td></tr>
		<!--<tr><td><a href="https://tice.agroparistech.fr/coursenligne/main/exercice/exercice.php?cidReq=ExcelVBA" target="_top">Quizz</a></td></tr>-->
		<tr><td><a href="https://tice.agroparistech.fr/coursenligne/main/forum/index.php?cidReq=ExcelVBA" target="_top">Forum</a></td></tr>
		<tr><td><a href="https://tice.agroparistech.fr/coursenligne/main/compilatio/work.php?cidReq=ExcelVBA" target="_top">Travaux</a></td></tr>
		<tr><td><a href="https://tice.agroparistech.fr/coursenligne/courses/ExcelVBA/?id_session=0" target="_top">TICE</a></td></tr>
	</table>
	
	<!--l'image renvoie sur le site d'AgroParisTech-->
	<div class="paraImg" style="margin-top:50px;"><a href="http://www2.agroparistech.fr/" target="_blank"><img src="../images/APT.png" alt="AgroParisTech" style="max-width:90%;"/></a></div>
	
	<!--lien About + copyright-->
	<div id="About"><a href="../PagesDivers/About.html" target="_top">About</a></br>&copy;AgroParisTech</div> 
</div> <!-- fin de la barre latérale -->

<div id="cours">
	<div class="coursh2">Chapitre 7 - Définir ses propres fonctions</div>
		<div class="para">VBA offre la possibilité de créer ses propres fonctions, qui peuvent être utilisées dans Excel comme n’importe quelle fonction intégrée.</div>
	<div class="coursh3">Utiliser les fonctions intégrées d’Excel</div>
		<div class="para">Toutes les fonctions intégrées d’Excel utilisable depuis VBA sont en fait des méthodes d’objets. Pour utiliser une fonction intégrée d’Excel dans VBA, il faut préciser à VBA où peut être trouvée cette fonction. Pour cela, il faut donc comme indiqué dans le <a href="AccesFonctionnalites.html#methode" target="_blank">chapitre 3</a> faire précéder le nom de la fonction de l’objet sur lequel elle va s’appliquer.</div>
		<div class="para">Par exemple, l’objet WorkSheetFunction permet d’accéder à de nombreuses fonctions courantes telles que la fonction <span class="function">Min</span>. Le code correspondant est donc :</div>
		<div class="codeExample">WorkSheetFunction.Min()</div>
		<div class="Warning">Toutes les fonctions intégrées d’Excel ne sont pas disponibles dans VBA. Néanmoins, il est fortement conseillé d’utiliser une fonction intégrée d’Excel pour faire un calcul donné, si cette dernière existe, plutôt que de définir sa propre fonction, qui serait moins efficace en termes de temps de calcul.</div>
	
	<div class="coursh3">Définition	d'une fonction</div>
		<div class="para">Jusqu’à présent nous n’avons créé que des <div class="important" data-txt="Ensemble nommé d’instructions ne renvoyant pas de valeur.">procédures</div> sans arguments, c'est-à-dire ne nécessitant pas d’apport d’information extérieure pour réaliser leurs tâches. Cependant, lorsque l’on souhaite que l’action d’une procédure dépende d’un contexte, de l’information sur ce contexte doit être apportée en entrée de la procédure sous forme d'arguments.</div>
		<div class="para">Une fonction est une suite d'instructions qui retourne une valeur. Elle commence par le mot clé <span class="function">Function</span> suivi du nom de la fonction et d’une liste d’arguments entre parenthèses, qui peut être vide. Elle se termine par le mot clé <span class="function">End Function</span>.</div>
		<div class="para">Une fonction indique la valeur à retourner en initialisant son nom avec la valeur de retour.</div>
		<div class="para">Une fonction a donc la syntaxe suivante :</div>
		<div class="codeExample">
			<p><span class="keyWord">Function</span> NomFonction([argument_1,..., argument_n])</p>
			<p style="padding-left:20px;">Instructions</p>
			<p style="padding-left:20px;">...</p>
			<!--??? Essaie de mettre les commentaires en vert comme dans VBE ???-->
			<p style="padding-left:20px;">NomFonction = Expression <span class="comment">'valeur de retour</span></p>
			<p style="padding-left:20px;">...</p>
			<p class="keyWord">End Function</p>
		</div> <!-- fin de l'exemple-->
		<div>Dans les exemples, les crochets [ ] signifient que les arguments sont facultatifs.</div>
		<div class="Forbiden">Dans VBA, les arguments d’une fonction sont séparés par des virgules, alors que dans Excel ils sont séparés par des points-virgules.</div>
	
	<div class="coursh3">Exercice guidé</div>
		<div class="para">Parce que le meilleur moyen d'apprendre est en le faisant soi-même, voici un exercice guidé sur la définition des fonctions ! Suivez le bien pas à pas et tout se passera bien.</div>
		<div class="para">On cherche à écrire une fonction qui calcule la surface d’un cercle à partir de son rayon.</div>
		<div class="para"><strong>1)</strong> Ouvrir le classeur <span class="function">TEST-MACRO.XLS</span>, puis l’éditeur de Visual Basic.</div>
		<div class="para"><strong>2)</strong> Insérer un nouveau module de code <span class="function">MODULE2</span> et écrire la fonction suivante :</div>
		<div class="codeExample">
			<p><span class="keyWord">Function</span> SurfaceCercle(Rayon <span class="keyWord">As</span> Double) <span class="keyWord">As</span> Double</p>
			<p style="padding-left:20px;">SurfaceCercle = WorksheetFunction.Pi() * Rayon * Rayon</p>
			<p class="keyWord">End Function</p>
		</div> <!--fin de l'exemple-->
		<div class="para"><span class="function">SurfaceCercle</span> est une fonction à <u>un</u> argument : le rayon du cercle <span class="function">Rayon</span>, qui est une variable de type réel (<span class="function">Double</span>). Elle renvoie la surface du cercle de rayon <span class="function">Rayon</span>, qui est de type réel (<span class="function">Double</span>). <span class="function">Pi</span> est une fonction intégrée d’Excel.</div>
		<div class="Remark">On peut typer les arguments d’une procédure ou d’une fonction et la valeur de retour d’une fonction.</div>
		<div class="Warning">Dans VBA les réels sont écrits avec des points, alors qu’ils sont écrits avec des virgules dans Excel.</div>
		<div class="para"><strong>3)</strong> Retourner dans Excel et saisir les données suivantes dans la feuille de calcul <span class="function">FEUIL1</span> :</div>
		<div class="paraImg"><img src="../images/Fonctions/ExGuide1.png" alt="ExGuide1" style="max-width:100%;"/></div>
		<div class="para"><strong>4)</strong> Si on note dans la cellule B6, la formule <span class="function">=SurfaceCercle(A6)</span> et que l’on procède de manière analogue pour les cellules suivantes, on obtient le résultat suivant :</div>
		<div class="paraImg"><img src="../images/Fonctions/ExGuide2.png" alt="ExGuide2" style="max-width:100%;"/></div>
		<div class="para">Lorsqu’on écrit <span class="function">=SurfaceCercle(A6)</span> dans la cellule B6 la valeur de la cellule A6 est transmise à la fonction <span class="function">SurfaceCercle</span> par le biais de l’argument <span class="function">Rayon</span>. La fonction <span class="function">SurfaceCercle</span> initialise alors son propre nom avec le résultat calculé (<span class="function">WorksheetFunction.Pi() * Rayon * Rayon</span>). Le résultat est ensuite retourné à la cellule B6.</div>
		<div class="para">La fonction <span class="function">SurfaceCercle</span> peut être utilisée comme n’importe quelle fonction intégrée d’Excel (onglet <span class="capital">formule - insérer une FONCTION</span>). Par contre, elle n'apparaît pas dans la liste des macros d’Excel.</div>
		<div class="Warning">Contrairement à une procédure, une fonction retourne une valeur. Lorsqu’on utilise cette fonction dans une autre fonction ou une autre procédure, la valeur renvoyée doit être sauvegardée dans une variable. Par exemple, la fonction <span class="function">SurfaceCercle</span> peut être utilisée dans la procédure <span class="function">MacroTestFonction</span> dont le code est fourni ci-dessous.</div>
		<div class="codeExample">
			<p><span class="keyWord">Sub</span> MacroTestFonction()</p>
			<p  style="padding-left:20px;"><span class="keyWord">Dim</span> valeur <span class="keyWord">As</span> Double</p>
			<p style="padding-left:20px;">valeur = SurfaceCercle(1.5)</p>
			<p style="padding-left:20px;">Range("B1").Value = valeur</p>
			<p class="keyWord">End Sub</p>
		</div> <!--fin de l'exemple-->
		<div class="para">Ici la variable <span class="function">valeur</span> reçoit le résultat de la function <span class="function">SurfaceCercle</span> pour un rayon donné égal à 1.5.</div>
	
	<div class="coursh3">L’instruction With...End With</div>
		<div class="para">L’instruction <span class="function">With...End With</span> est utile lorsque les références à un objet sont répétées plusieurs fois dans une petite section de code.</div>
		<div class="para"><span style="text-decoration:underline;">Exemple</span> :</div>
		<div class="codeExample">
			<p><span class="keyWord">Sub</span> ModifiePolice(MaPlage <span class="keyWord">As</span> Range)</p>
			<p style="padding-left:20px;">MaPlage.Select</p>
			<p style="padding-left:20px;">Selection.Font.Size = 12</p>
			<p style="padding-left:20px;">Selection.Font.ColorIndex = 3</p>
			<p style="padding-left:20px;">Selection.Font.Italic = <span class="keyWord">True</span></p>
			<p class="keyWord">End Sub</p>
		</div> <!--fin de l'exemple-->
		<div class="para">La macro <span class="function">ModifiePolice</span> peut être réécrite plus simplement comme suit :</div>
		<div class="codeExample">
			<p><span class="keyWord">Sub</span> ModifiePolice(MaPlage <span class="keyWord">As</span> Range)</p>
			<p>MaPlage.Select</p>
			<p><span class="keyWord">With</span> Selection.Font</p>
			<p style="padding-left:20px;">.Size = 12</p>
			<p style="padding-left:20px;">.ColorIndex = 3</p>
			<p style="padding-left:20px;">.Italic = <span class="keyWord">True</span></p>
			<p class="keyWord" style="padding-left:20px;">End With</p>
			<p class="keyWord">End Sub</p>
		</div> <!--fin de l'exemple-->
		<div class="Remark">Tout ce qui commence par un point dans un bloc d’instructions <span class="keyWord">With...End With</span> est une propriété ou une méthode de l’objet qui suit l’instruction <span class="keyWord">With</span>.</div>
		
	
	<div class="barre" style="margin:40px 0;"></div>
	<div class="para" style="margin-top:50px;">Ce chapitre est terminé, à vous de jouer ! &#139; <a href="../Exercices/ex_Fonctions.html" target = "_blanc" class="important">lien vers les exercices</a> &#155;</div>
	
	<ul id="nav">		
		<li id="navPrevious"><a href="Boucles.html">&laquo;</a></li>
		<li id="navMenu"><a href="../PagesDivers/Accueil.html">&#8801;</a></li>
		<li id="navNext"><a href="Tableaux.html">&raquo;</a></li>
	</ul>		
	
	<script type="text/javascript" src="../infobulle.js"></script>
			
</div> <!-- fin du cours -->
</body>
</html>