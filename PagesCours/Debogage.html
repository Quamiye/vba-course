<html lang="fr">
<head>
	<title>Debogage</title>
	<link rel="stylesheet" href="../Template1CSS.css">
	<meta name="viewport" content="width=device-width, height=device-height, initial-scale=1.0">
	<meta charset="utf-8"/>
	</head>

<body>

<div id="lateral">
	<!--Titre-->
	<div id="title">Programmation VBA pour Excel</div>
	
	<!--Tableau menu-->
	<table id="tabmenu">
		<tr><td><a href="../PagesDivers/Accueil.html" target="_top">Accueil</a></td></tr>
		<tr><td><a href="../PagesCours/SommaireCours.html" target="_top">Sommaire du cours</a></td></tr>
		<tr><td><a href="../Exercices/SommaireExo.html" target="_top">Sommaire des exercices</a></td></tr>
		<tr><td><a href="../PagesDivers/Resume.html" target="_blank">Résumé du cours</a></td></tr>
		<!--<tr><td><a href="https://tice.agroparistech.fr/coursenligne/main/exercice/exercice.php?cidReq=EXCELVBA" target="_top">Quizz</a></td></tr>-->
		<tr><td><a href="https://tice.agroparistech.fr/coursenligne/main/forum/index.php?cidReq=EXCELVBA" target="_top">Forum</a></td></tr>
		<tr><td><a href="https://tice.agroparistech.fr/coursenligne/main/compilatio/work.php?cidReq=EXCELVBA" target="_top">Travaux</a></td></tr>
		<tr><td><a href="https://tice.agroparistech.fr/coursenligne/courses/EXCELVBA/?id_session=0" target="_top">TICE</a></td></tr>
	</table>
	
	<!--l'image renvoie sur le site d'AgroParisTech-->
	<div class="paraImg" style="margin-top:50px;"><a href="http://www2.agroparistech.fr/" target="_blank"><img src="../images/APT.png" alt="AgroParisTech" style="max-width:90%;"/></a></div>
	
	<!--lien About + copyright-->
	<div id="About"><a href="../PagesDivers/About.html" target="_top">About</a></br>&copy;AgroParisTech</div> 
</div> <!-- fin de la barre latérale -->

<div id="cours">
	<div class="coursh2">Bonus 1 - Le débogage</div>
	<div class="para">Le débogage consiste à régler les erreurs directement liées au code d’un programme. Trois types d’erreur peuvent affecter un programme écrit en VBA :</div>
	<div class="list">
		<li>des erreurs de compilation qui surviennent lorsque VBA rencontre une instruction qu’il ne reconnaît pas ;</li>
		<li>des erreurs d’exécution ;</li>
		<li>des erreurs logiques : le programme s’exécute mais le résultat obtenu ne correspond pas à celui attendu.</li>
	</div> <!--fin de la liste-->
	
	<div class="coursh3">Les erreurs de compilation et d’exécution</div>
		<div class="para">La première étape pour tester un programme consiste à compiler le programme à l’aide de la commande <span class="capital">DEBOGAGE - COMPILER VBAPROJECT</span>. Les erreurs de compilation sont mises en évidence. Recommencer la compilation jusqu’à ce que toutes les erreurs de compilation soient corrigées.</div>
		<div class="para">Lorsqu’il n’y a plus d’erreurs de compilation, exécuter le programme à l’aide de la commande <span class="capital">EXECUTION - EXECUTER SUB/USERFORM</span>.</div>
		<div class="para">Si une erreur d’exécution est générée, l’instruction coupable est mise en évidence. Corriger l’erreur et réinitialiser le programme à l’aide de la commande <span class="capital">EXECUTION - REINITIALISER</span>. Recommencer l’exécution jusqu’à ce que toutes les erreurs d’exécution soient corrigées.</div>
		
	<div class="coursh3">Les erreurs logiques - Exercice guidé</div>
		<div class="para">Il s’agit maintenant de corriger les erreurs logiques qui sont les plus difficiles à repérer. L’éditeur de Visual Basic propose plusieurs outils de débogage dans le menu <span class="capital">DEBOGAGE</span>.</div>
		<div class="para"><b>1) </b>Ouvrir le classeur <span class="function">ELEVES.XLS</span>.</div>
		<div class="Remark">Vous trouverez le classeur <span class="function">ELEVES.XLS</span> dans les documents du cours sur la plateforme TICE, <a href="https://tice.agroparistech.fr/coursenligne/main/document/document.php?cidReq=EXCELVBA" target="_blank" class="important">ici</a>.</div>
		<div class="paraImg"><img src="../images/Debogage/eleve1.png" alt="eleve1" style="max-width:100%;"/></div>
		<div class="para"><b>2) </b>Ouvrir l’éditeur de Visual Basic à partir du classeur <span class="function">ELEVES.XLS</span>.</div>
		<div class="para"><b>3) </b>Ouvrir un nouveau module de code à l’aide de la commande <span class="capital">INSERTION - MODULE</span>. Une fenêtre de code <span class="function">MODULE1</span> s’ouvre.</div>
		<div class="para"><b>4) </b>Dans le module de code <span class="function">MODULE1</span>, saisir la procédure suivante qui permet de supprimer les lignes vides de la liste de données :</div>
		<div class="codeExample">
			<p><span class="keyWord">Sub</span> SupprLignesVides()</p>
			<p style="padding-left:20px;"><span class="keyWord">Dim</span> MaPlage <span class="keyWord">As</span> Range</p>
			<p style="padding-left:20px;"><span class="keyWord">Dim</span> Cellule <span class="keyWord">As</span> Range</p>
			<p style="padding-left:20px;"><span class="keyWord">Set</span> MaPlage = Range("A1:A19")</p>
			<p style="padding-left:20px;"><span class="keyWord">For Each</span> Cellule <span class="keyWord">In</span> MaPlage</p>
			<p style="padding-left:40px;"><span class="keyWord">If IsEmpty(Cellule) <span class="keyWord">Then</span></p>
			<p style="padding-left:60px;">Rows(Cellule.Row).Delete <span class="comment">'supprime toute la ligne</span></p>
			<p style="padding-left:40px;" class="keyWord">End If</p>
			<p style="padding-left:40px;"><span class="keyWord">Next</span> Cellule</p>
			<p class="keyWord">End Sub</p>
		</div> <!--fin de l'exemple-->
		<div class="Remark">La fonction <span class="function">IsEmpty</span> permet de tester si une cellule est vide.</div>
		<div class="para"><b>5) </b>Exécuter la procédure <span class="function">SupprLignesVides</span>. On constate que s’il existe deux lignes vides consécutives, la deuxième ligne n’est pas supprimée.</div>
		<div class="para"><b>6) </b>Insérer de nouveau des lignes dans la liste de données pour obtenir la même liste de données qu'au départ (celle du point (1)).</div>
		<div class="para"><b>7) </b>Dans l’éditeur de Visual Basic, espionner la valeur des variables <span class="function">Cellule.Row</span> et <span class="function">Cellule</span> à l’aide de la commande <span class="capital">DEBOGAGE - AJOUTER UN ESPION</span>. La fenêtre ESPIONS s’ouvre.</div>
		<div class="para"><b>8) </b>Réduire la fenêtre de l’éditeur de Visual Basic de façon à voir le classeur EXCEL au second plan.</div>
		<div class="para"><b>9) </b>Exécuter pas à pas la procédure <span class="function">SupprLignesVides</span> à l’aide de la commande <span class="capital">DEBOGAGE - PAS A PAS DETAILLE</span> (touche F8). Observer attentivement l’effet de chaque instruction de la procédure sur le classeur Excel et examiner les valeurs prises par les variables <span class="function">Cellule.Row</span> et <span class="function">Cellule</span>.</div>
		<div class="para">Lorsque la procédure atteint la cellule A4, la ligne 4 est supprimée. Cela a pour conséquence de décaler toutes les cellules vers le haut. La cellule A5 passe alors en A4, la cellule A6 en A5... La boucle <span class="function">For Each...Next</span> traite ensuite la cellule suivante soit la cellule A5. Le contenu de la cellule précédemment en A5 ne sera donc pas traité, puisque cette cellule est passée en A4.</div>
		<div class="para"><b>10) </b>Arrêter l’exécution de la procédure à l’aide de la commande <span class="capital">EXECUTION - ARRET</span>.</div>
		<div class="para"><b>11) </b>Une solution possible au bogue est de dérouler une boucle commençant par la dernière cellule de la liste de données.</div>
		<div class="codeExample">
			<p><span class="keyWord">Sub</span> SupprLignesVidesCorrigée()</p>
			<p style="padding-left:20px;"><span class="keyWord">Dim</span> compteur <span class="keyWord">As</span> Integer</p>
			<p style="padding-left:20px;"><span class="keyWord">Dim</span> DerLigne <span class="keyWord">As</span> Integer</p>
			<p style="padding-left:20px;"><span class="keyWord">Dim</span> MaPlage <span class="keyWord">As</span> Range</p>
			<p style="padding-left:20px;"><span class="keyWord">Set</span> MaPlage = Range("A1:A19")</p>
			<p style="padding-left:20px;">DerLigne = MaPlage.Rows.Count</p>
			<p style="padding-left:20px;"><span class="keyWord">For</span> compteur = DerLigne <span class="keyWord">To</span> 1 Step -1</p>
			<p style="padding-left:40px;"><span class="keyWord">If</span> IsEmpty(Range("A" & compteur))</p>
			<p style="padding-left:40px;"><span class="keyWord">Then</span> Rows(compteur).Delete</p>
			<p style="padding-left:40px;" class="keyWord">Next compteur</p>
			<p class="keyWord">End Sub</p>
		</div><!--fin de l'exemple-->
		
		<div class="Remark">Vous pouvez voir les différents outils de débogage sur <a class="important" href="AstucesRemarques.html#debogage" target="_blanck">cette page.</a></div>

		<div class="barre" style="margin:40px 0;"></div>
		<div class="para" style="margin-top:50px;">Ce chapitre est terminé, vous pouvez passer au <a href="ExecuterMacro.html" class="important">chapitre suivant</a>.</div>	
		
	<ul id="nav">		
		<li id="navPrevious"><a href="UserForm.html">&laquo;</a></li>
		<li id="navMenu"><a href="../PagesDivers/Accueil.html">&#8801;</a></li>
		<li id="navNext"><a href="ExecuterMacro.html">&raquo;</a></li>
	</ul>	

			
</div> <!-- fin du cours -->
</body>
</html>